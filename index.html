<!DOCTYPE html>
<html lang="en">
<head>
	<title>REST for Kottans</title>
	<meta charset="utf-8">
	<meta http-equiv="x-ua-compatible" content="ie=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="node_modules/shower-ribbon/styles/screen-16x10.css">
</head>
<body class="shower list">
	<header class="caption">
		<h1>REST for Kottans</h1>
		<p>from Artem Bei</p>
	</header>
	<section class="slide" id="cover">
		<h2>REST for Kottans</h2>
		<p>from <a href="https://ua.linkedin.com/in/artembey
">Artem Bei</a></p>
		<img src="pictures/nose-up.jpg" alt="" class="cover">
		<!--
			To apply styles to the certain slides
			set slide ID to get needed elements
			-->
		<style>
			#cover h2 {
				margin:30px 0 0;
				color:#FFF;
				text-align:center;
				font-size:70px;
				}
			#cover p {
				margin:10px 0 0;
				text-align:center;
				color:#FFF;
				font-style:italic;
				font-size:20px;
				}
				#cover p a {
					color:#FFF;
					}
				.small-code code {
					font-size: 0.65em;
				}
				.xs-code code {
					font-size: 0.4em;
				}

				.low-text {
					font-size: 0.75em;
					color: #777;
				}

		</style>
	</section>
	<section class="slide">
		<h2>API</h2>
		<p>is application programming interface</p>
	</section>

	<section class="slide">
		<h2>Web API</h2>
		<p>Interface to web application</p>
		<ul>
			<li>REST</li>
			<li>SOAP</li>
			<li>XML-RPC</li>
			<li>etc ...</li>
		</ul>
	</section>

	<section class="slide">
		<h2>Remote Procedure Call</h2>
		<pre class="small-code">
			<code>&lt;soap:Envelope xmlns:soap=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&gt;</code>
			<code> &lt;soap:Body&gt;</code>
			<code>  &lt;getProductDetails xmlns=&quot;http://warehouse.example.com/ws&quot;&gt;</code>
			<code>    &lt;productID&gt;12345&lt;/productID&gt;</code>
			<code>  &lt;/getProductDetails&gt;</code>
			<code> &lt;/soap:Body&gt;</code>
			<code>&lt;/soap:Envelope&gt;</code>
		</pre>
	</section>

	<section class="slide">
		<h2>HTTP API</h2>
		<p>
			Extensive use HTTP protocol features for API implementation
		</p>
	</section>

	<section class="slide">
		<h2>RESTful API</h2>
		<p>
			API in REST systems
		</p>
	</section>

	<section class="slide">
		<figure>
		<blockquote>
			<p>
				Representational State Transfer (REST) architectural style for distributed hypermedia systems
			</p>
		</blockquote>
			<figcaption style="font-size: 0.75em;">Roy Fielding, <a href="https://www.ics.uci.edu/~fielding/pubs/dissertation/top.htm">Architectural Styles and the Design of Network-based Software Architectures</a></figcaption>

		</figure>
	</section>

	<section class="slide">
		<h2>REST constraints</h2>
		<ol>
			<li>Client-Server</li>
			<li>Stateless</li>
			<li>Cache</li>
			<li>Uniform Interface</li>
			<li>Layered System</li>
			<li>Code-On-Demand</li>
		</ol>
	</section>

	<section class="slide">
		<h2>HTTP is the protocol for REST systems</h2>
		<p>So lets dive deep in HTTP</p>
	</section>

	<section class="slide">
		<h2>Request-Response</h2>
		<p>
			<img src="pictures/http-rr.png" width="500" />
		</p>
	</section>

	<section class="slide">
		<h2>HTTP Headers</h2>
		<p><i>curl https://api.github.com --verbose</i></p>
		<p>
			<pre class="small-code">
				<code>> GET / HTTP/1.1</code>
				<code>> Host: api.github.com</code>
				<code>> User-Agent: curl/7.43.0</code>
				<code>> Accept: */*</code>
				<code>...</code>
			</pre>
			<pre class="small-code">
				<code>< HTTP/1.1 200 OK</code>
				<code>< Server: GitHub.com</code>
				<code>< Content-Type: application/json; charset=utf-8</code>
				<code>< Content-Length: 2064</code>
				<code>...</code>
			</pre>
		</p>
	</section>

	<section class="slide">
		<h2>URI</h2>
		<p>Unique Resource Identifier</p>
	</section>

	<section class="slide">
		<h2>Methods</h2>
		<ul>
			<li>GET</li>
			<li>POST</li>
			<li>PUT</li>
			<li>DELETE</li>
			<li>OPTIONS</li>
			<li>PATCH</li>
			<li>...</li>
		</ul>
	</section>

	<section class="slide">
		<h2>Methods</h2>
		<ul>
			<li><strong>GET</strong></li>
			<li><strong>POST</strong></li>
			<li><strong>PUT</strong></li>
			<li><strong>DELETE</strong></li>
			<li>OPTIONS</li>
			<li>PATCH</li>
			<li>...</li>
		</ul>
	</section>


	<section class="slide">
		<h2>Statuses</h2>
		<img src="pictures/http-codes.png" width="400">
	</section>

	<section class="slide">
		<h2>Headers</h2>
		<ul>
			<li>Host</li>
			<li>Accept</li>
			<li>Content-type</li>
			<li>Authorization</li>
			<li>Cookie</li>
			<li>Allow</li>
			<li>...</li>
			<li>X- headers</li>
		</ul>
	</section>

	<section class="slide">
		<h2>Back to the REST</h2>
		<img src="pictures/richardson-overview.png" width="500">
		<p>
			<i class="low-text">* next pictures stolen from Martin Fowler blog</i>
		</p>
	</section>

	<section class="slide">
		<h2>REST level 0</h2>
		<p>Like remote procedure call</p>
		<img src="pictures/r-0.png" width="500">
	</section>

	<section class="slide">
		<h2>REST level 1</h2>
		<p>Introduce Resources accessible via URI</p>
		<img src="pictures/r-1.png" width="500">
	</section>

	<section class="slide">
		<h2>REST level 2</h2>
		<p>Add more HTTP stuff</p>
		<img src="pictures/r-2.png" width="500">
	</section>

	<section class="slide">
		<h2>Represent our actions in HTTP terms</h2>
		<img src="pictures/methods-codes.png" width="600">
	</section>

	<section class="slide">
		<h2>REST level 3</h2>
		<p>Add links and make data live</p>
		<img src="pictures/r-3.png" width="500">
	</section>

	<section class="slide">
		<p>API like controls for state-machine</p>
		<img src="pictures/e-1.png" height="400">
	</section>

	<section class="slide">
		<p>API like controls for state-machine</p>
		<img src="pictures/e-2.png" height="400">
	</section>

	<section class="slide">
		<p>API like controls for state-machine</p>
		<img src="pictures/e-3.png" height="400">
	</section>

	<section class="slide">
		<p>API like controls for state-machine</p>
		<img src="pictures/e-4.png" height="200">
	</section>

	<section class="slide">
		<p>API like controls for state-machine</p>
		<img src="pictures/e-5.png" height="300">
	</section>

	<section class="slide">
		<p>API like controls for state-machine</p>
		<img src="pictures/e-6.png" height="300">
	</section>

	<section class="slide">
		<h2>Hypermedia or HATEOAS</h2>
		<ul>
			<li>HAL</li>
			<li>Siren</li>
			<li>JSON API</li>
		</ul>
	</section>

	<section class="slide">
		<h2>Node.js ecosystem for API development</h2>
		<ul>
			<li>Express</li>
			<li>Koa</li>
			<li>HAPI</li>
			<li>restify</li>
			<li>Loopback</li>
		</ul>
	</section>

	<section class="slide">
		<h2>Express</h2>
		<p>Fast, unopinionated, minimalist web framework for Node.js</p>
		<ul>
			<li>26k stars on Github</li>
			<li>6,456,205 downloads in the last month on NPM</li>
			<li>major version is 4</li>
		</ul>
	</section>

	<section class="slide">
		<h2>Express</h2>
		<ul>
			<li>Routing</li>
			<li>Middlewares</li>
			<li>Error handling</li>
			<li>Security</li>
			<li>Useful packages</li>
		</ul>
	</section>

	<section class="slide">
		<h2>Express</h2>
		<p>Node.js style Hello World</p>
		<img src="pictures/express-hello-world.png" width="500">
	</section>

	<section class="slide">
		<h2>Express Routing</h2>
		<p>Route path</p>
			<code>
app.get(<mark>'/users/:userId'</mark>, function(req, res) {});
			</code>
	</section>

	<section class="slide">
		<h2>Express Routing</h2>
		<p>Routes modularity</p>
		<pre class="small-code">
<code>//users.js</code>
<code>let userRouter = express.Router();</code>
		</pre>
		<pre class="small-code">
<code>//items.js</code>
<code>let itemRouter = express.Router();</code>
</pre>

		<pre class="small-code">
<code>//app.js</code>
<code>import userRouter from './users';</code>
<code>import itemRouter from './items';</code>
<code><mark>app.use('/users', userRouter);</mark></code>
<code><mark>app.use('/items', itemRouter);</mark></code>
</pre>
	</section>

	<section class="slide">
		<h2>Middleware functions</h2>
		<p>Middleware functions are functions that have access to the request object (req), the response object (res), and the next middleware function in the application’s request-response cycle.</p>
<pre class="small-code">
<code>function printMethod(req, res, next) {</code>
<code>	console.log('Method is', req.method);</code>
<code>	next();</code>
<code>}</code>
</pre>
	</section>

	<section class="slide">
		<h2>Middleware functions</h2>
<pre>
<code>router.use('/', <mark>validateToken, checkPermissions</mark>);</code>
<code>router.post('/users', <mark>[validateInput, handleUserCreate]</mark>);</code>
</pre>
	</section>

	<section class="slide">
		<h2>Error handling</h2>
<pre>
<code>if(err) return next(err);</code>
</pre>

<pre>
<code>app.use(function(<mark>err</mark>, req, res, next) {</code>
<code>  console.error(err.stack);</code>
<code>  res.status(500).send('Something broke!');</code>
<code>});</code>
</pre>
	</section>

	<section class="slide">
		<h2>Protect your API</h2>
		<ul>
			<li>Use HTTPS (it`s free now)</li>
			<li>Authentication & Authorization</li>
			<li>CORS</li>
			<li>Rate limit requests</li>
			<li>IP whitelists</li>
		</ul>
	</section>

	<section class="slide">
		<h2>Passport middleware</h2>
		<p><a href="http://passportjs.org/">http://passportjs.org/</a></p> middleware with more than 300 authentication strategies
		<ul>
			<li>Sessions</li>
			<li>JSON Web Tokens</li>
			<li>OAuth</li>
			<li>...</li>
		</ul>
	</section>



	<section class="slide">
		<h2>Project Structure</h2>
	</section>

	<section class="slide">
		<h2>Project Structure: package.json</h2>
<pre class="small-code">
	<code>
"scripts": {
  "start": "pm2 delete api; <mark>pm2</mark> start run.js --name api
  --log-date-format='YYYY-MM-DD HH:mm Z';",
  "dev": "<mark>NODE_ENV=development</mark> nodemon run.js"
  <mark>"test": "NODE_ENV=test mocha"</mark>
}
	</code>
</pre>
	</section>

	<section class="slide">
		<h2>Project Structure: code</h2>
<pre class="small-code">
	<code>
doc/
config/
migrations/
middlewares/
routes/
services/ | models/
test/
  unit/
  api/
app.js
run.js
package.json
	</code>
</pre>
	</section>

	<section class="slide">
		<h2>Project Structure: routes</h2>
		<p>Routes grouping</p>
		<ul>
			<li>by features</li>
			<li>by consumer</li>
			<li>by API versions (v1, v2 ...)</li>
		</ul>
	</section>

	<section class="slide">
		<h2>Apply Hypermedia: Root Route</h2>
		<p>Expose first route with links</p>

<pre class="small-code">
<code>rootRouter.get(url.add("self", "/api/root"), (req, res, next) => {</code>
<code>  res.apiResponse({</code>
<code>    links: {</code>
<code>      users: url.get("users"),</code>
<code>      profile: url.get("profile")</code>
<code>    }</code>
<code>  });</code>
<code>});</code>
</pre>
	</section>

	<section class="slide">
		<h2>Apply Hypermedia: Versions</h2>
		<p>Client send request with header</p>
		<p><mark>Accept: application/vnd.mycompany.myapp-v2+json</mark></p>

<pre class="small-code">
<code>rootRouter.get(url.add("self", "/api/root"), (req, res, next) => {</code>
<code>  let mediaType = req.get('Accept');</code>
<code>  res.apiResponse({</code>
<code>    links: <mark>getLinks(mediaType)</mark></code>
<code>  });</code>
<code>});</code>
</pre>
	</section>

	<section class="slide">
		<h2>API Testing</h2>
		<ul>
			<li>Be sure that everything works</li>
			<li>Fast feedback in development time</li>
			<li>Developer can read tests like specification</li>
		</ul>
	</section>

	<section class="slide">
		<h2>API Testing</h2>
<pre class="small-code">
<code>describe('GET /users', function() {</code>
<code>  it('respond with json', function(done) {});</code>
<code>  it('should return array of users', function(done) {});</code>
<code>});</code>
</pre>
	</section>

	<section class="slide">
		<h2>API Testing via Mocha + Supertest</h2>

<pre class="small-code">
<code>  it('respond with json', function(done) {</code>
<code>    request(app)</code>
<code>      .get('/users')</code>
<code>      .set('Accept', 'application/json')</code>
<code>      <mark>.expect(200)</mark></code>
<code>      .end(function(err, res) {</code>
<code>        if (err) return done(err);</code>
<code>        done();</code>
<code>      });</code>
<code>  });</code>
</pre>
	</section>

	<section class="slide">
		<h2>Design your API</h2>
		<ul>
			<li>ApiDoc</li>
			<li>Swagger</li>
			<li>Blueprint</li>
			<li>RAML</li>
		</ul>
	</section>

	<section class="slide">
		<h2>Frameworks</h2>
		<ul>
			<li>Sails.js</li>
			<li>HAPI</li>
			<li>Feathers</li>
			<li>restify</li>
			<li>Loopback</li>
		</ul>
	</section>

	<section class="slide">
		<h2>Other modern approaches</h2>
		<ul>
			<li>GraphQL</li>
			<li>Meteor</li>
			<li>WebSockets</li>
		</ul>
	</section>
	<!--
		To hide progress bar from entire presentation
		just remove “progress” element.
		-->
	<div class="progress"></div>
	<script src="node_modules/shower-core/shower.min.js"></script>
	<!-- Copyright © 2015 Yours Truly, Famous Inc. -->
	<!-- Photos by John Carey, fiftyfootshadows.net -->
</body>
</html>
